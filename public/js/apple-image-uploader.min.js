/*! Image Uploader - v1.2.3 - 26/11/2019
 * Copyright (c) 2019 Christian Bayer; Licensed MIT */
!function(e){e.fn.appleImageUploader=function(t){let n,i={preloaded:[],imagesInputName:"images",preloadedInputName:"preloaded",label:"Drag & Drop files here or click to browse",maxSizeLabel:"Максималния разрешен брой за качване на снимки е ",extensions:[".jpg",".jpeg",".png",".gif",".svg"],mimes:["image/jpeg","image/png","image/gif","image/svg+xml"],maxSize:void 0,maxFiles:void 0},a=this;a.settings={},a.init=function(){a.settings=e.extend(a.settings,i,t),a.each((function(t,n){let i=s();if(e(n).append(i),i.on("dragover",o.bind(i)),i.on("dragleave",o.bind(i)),i.on("drop",p.bind(i)),a.settings.preloaded.length){i.addClass("has-files");let e=i.find(".uploaded");for(let t=0;t<a.settings.preloaded.length;t++)e.append(d(a.settings.preloaded[t].src,a.settings.preloaded[t].id,!0))}}))};let s=function(){let t=e("<div>",{class:"image-uploader"});n=e("<input>",{type:"file",id:a.settings.imagesInputName+"-"+h(),name:a.settings.imagesInputName+"[]",accept:a.settings.extensions.join(","),multiple:""}).appendTo(t);e("<div>",{class:"uploaded"}).appendTo(t);let i=e("<div>",{class:"upload-text"}).appendTo(t);e("<i>",{class:"iui-cloud-upload"}).appendTo(i),e("<span>",{text:a.settings.label}).appendTo(i);return t.on("click",(function(e){l(e),n.trigger("click")})),n.on("click",(function(e){e.stopPropagation()})),n.on("change",p.bind(t)),t},l=function(e){e.preventDefault(),e.stopPropagation()},d=function(t,n,i){let s=e("<div>",{class:"uploaded-image"});e("<img>",{src:t}).appendTo(s);if(i){s.attr("data-preloaded",!0);e("<input>",{type:"hidden",name:a.settings.preloadedInputName+"[]",value:n}).appendTo(s)}else s.attr("data-index",n);return s.on("click",(function(e){l(e)})),s},o=function(t){l(t),"dragover"===t.type?e(this).addClass("drag-over"):e(this).removeClass("drag-over")},p=function(t){l(t);let i=e(this),s=Array.from(t.target.files);if(s.length>a.settings.maxFiles)return r(i),n.val(""),!1;let d=[];if(e(s).each((function(e,t){a.settings.extensions&&!g(t)||a.settings.mimes&&!u(t)||a.settings.maxSize&&!c(t)||a.settings.maxFiles&&!f(d.length,t)||d.push(t)})),i.find(".uploaded").children().length>0&&r(i),d.length&&(i.removeClass("drag-over"),m(i,d),i.hasClass("has-files"))){let t=i.find("button.delete-image");i.find("button.delete-image").length>0?i.find("button.delete-image").fadeIn():(t=e("<button>",{class:"delete-image"}).appendTo(i),$i=e("<i>",{class:"iui-close"}).appendTo(t)),t.on("click",(function(e){l(e),r(i),n.val("")}))}};function r(e){e.find(".uploaded").children().remove(),e.removeClass("has-files"),e.find("button.delete-image").hide()}let g=function(e){return!(a.settings.extensions.indexOf(e.name.replace(new RegExp("^.*\\."),"."))<0)},u=function(e){return!(a.settings.mimes.indexOf(e.type)<0)},c=function(e){return!(e.size>a.settings.maxSize)},f=function(e,t){return!(e>=a.settings.maxFiles)},m=function(t,n){t.addClass("has-files");let i=t.find(".uploaded"),a=t.find('input[type="file"]');e(n).each((function(e,t){i.append(d(URL.createObjectURL(t),a[0].files.length-1),!1)})),a.prop("files",a[0].files)},h=function(){return Date.now()+Math.floor(100*Math.random()+1)};return this.init(),this}}(jQuery);